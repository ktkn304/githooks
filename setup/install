#!/usr/bin/env bash

set -eu

basedir=$(cd $(dirname $(dirname $0)) && pwd)
hooks_dir="$basedir/hooks"
hook_types_file="$basedir/setup/hook-types"

function load_hooktypes() {
    cat "$hook_types_file" | grep -v -e '^#' -e '^\s*$'
}

load_hooktypes | while read line || test -n "$line"
do
    echo "create: \"$hooks_dir/$line\""
    cat > "$hooks_dir/$line" <<EOF
#!/usr/bin/env bash
hook_base_file="\$(dirname \$(dirname \$0))/lib/hook-base"
. "\$hook_base_file"
EOF
    chmod +x "$hooks_dir/$line"
done

echo "change git config(global): core.hooksPath \"$hooks_dir\""
git config --global core.hooksPath "$hooks_dir"
